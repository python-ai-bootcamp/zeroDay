<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zero Day Boot Camp Terminal</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: black;
      color: #00FF00;
      font-family: 'VT323', monospace;
      font-size: 18px;
      margin: 0;
      padding: 20px;
      line-height: 1.5;
    }
    .terminal-line {
      margin: 5px 0;
      white-space: pre-wrap;
    }
    .terminal-prompt {
      color: red;
    }
    input {
      background-color: black;
      color: #00FF00;
      border: none;
      border-bottom: 1px solid #00FF00;
      font-family: 'VT323', monospace;
      font-size: 18px;
      width: auto;
      margin-top: 5px;
      outline: none;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div class="terminal-line">Zero Day Boot Camp Terminal v1.0</div>
    <div class="terminal-line">--------------------------------------</div>
    <div class="terminal-line">please enter valid email address:</div>
    <div class="terminal-line" style="display: flex; align-items: center;">
      <span class="terminal-prompt">root@0D@:~$ </span>
      <span id="prompt"></span>
      <input id="userInput" type="text" autofocus style="border: none; background: transparent; color: inherit; font-family: inherit; outline: none; width: auto;" />
    </div>
  </div>

  <script>
    let state = 'email';
    let riddleAnswerParis;
    if ($${{IS_DEV_MODE}}$$ == true){
      riddleAnswerParis=[{riddle:'Decipher the following code: bGV0bWVpbg==',answer:'letmein'}];
    }else{
      riddleAnswerParis=[
        {riddle:'Decipher the following code: bGV0bWVpbg==',answer:'letmein'},
        {riddle:'which is bigger pi or e?',answer:'pi'},
        {riddle:'How many bits are there in a single Gigabyte?',answer:'8589934592'},
        {riddle:'0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...',answer:'144'},
        {riddle:'solve following polish notation formula "x - 5 6 7"',answer:'-7'},
        {riddle:'which interval does following expression represents "0 */3 * * *". 20 minutes, 8 hours, 3 hours, 1 day, 3 days ?',answer:'3 hours'},
        {riddle:'What also floats in water?',answer:'a duck'},
        {riddle:'RSA, is an algorithm used for symmetric key cryptography? (yes/no)',answer:'no'},
        {riddle:'what is the name of a random string of data used to modify a password hash called?',answer:'salt'},
      ];
    }
    selectedRiddleAnswerPair=riddleAnswerParis[Math.floor(Math.random()*riddleAnswerParis.length)];
    let riddle = selectedRiddleAnswerPair.riddle;
    let answer = selectedRiddleAnswerPair.answer;
    const userData = { email: '', hacker_id: '', name: '', phone: '' };
  
    const terminal = document.getElementById('terminal');
    let userInput = document.getElementById('userInput');
    const promptSpan = document.getElementById('prompt');
  
    function appendLine(text) {
      const newLine = document.createElement('div');
      newLine.className = 'terminal-line';
      newLine.textContent = text;
      terminal.insertBefore(newLine, terminal.lastElementChild);
    }
  
    function clearTerminal() {
      terminal.innerHTML = '';
    }
  
    function updatePrompt(text = '') {
      promptSpan.textContent = text;
      userInput.focus();
    }
  
    function replaceInputField(type = 'text') {
      const newInput = document.createElement('input');
      newInput.id = 'userInput';
      newInput.type = type;
      newInput.style = userInput.style.cssText;
      userInput.replaceWith(newInput);
      userInput = newInput;
      userInput.focus();
      addInputListener();
    }
  
    function addInputListener() {
      userInput.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          const inputValue = userInput.value.trim();
          appendLine(inputValue);
          userInput.value = '';
  
          if (state === 'email') {
            userData.email = inputValue;
            appendLine(riddle);
            state = 'riddle';
            replaceInputField('password'); // Change input type to password
          } else if (state === 'riddle') {
            if (inputValue === answer) {
              appendLine('Access Granted');
              setTimeout(showNamePrompt, 1000);
            } else {
              appendLine('Access Denied');
              state = 'email';
              selectedRiddleAnswerPair=riddleAnswerParis[Math.floor(Math.random()*riddleAnswerParis.length)];
              riddle = selectedRiddleAnswerPair.riddle;
              answer = selectedRiddleAnswerPair.answer;
              replaceInputField('text'); // Reset to text input for email
            }
          } else if (state === 'name') {
            userData.name = inputValue;
            state='phone'
            appendLine('Please Enter Your Phone Number');
            replaceInputField('text');
          } else if (state === 'phone') {
            userData.phone = inputValue;
            state='blockedInput'
            sendDataToBackend(userData);
          } else if (state === 'blockedInput') {
            appendLine('');
          }
        }
      });
    }
  
    function showNamePrompt() {
      state = 'name';
      appendLine('');
      appendLine('Welcome to Zero Day Boot Camp');
      appendLine('You have been selected to participate in a training course');
      appendLine("If you should succeed in all provided challenges,");
      appendLine("you will be invited to participate in Zero Day Research Group.");
      appendLine('Enter your full name:');
      replaceInputField('text');
      updatePrompt();
    }
  
    function sendDataToBackend(data) {
      fetch('$${{PROTOCOL}}$$://$${{DOMAIN_NAME}}$$/submit', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
        .then(response => response.json())
        .then(data => {
          appendLine('Thank you. We will be in contact.');
          setTimeout(() => {
            document.body.innerHTML =
              '<div style="color:red; font-family: monospace; text-align:center; margin-top: 20%;">CRITICAL ERROR: System Crash</div>';
          }, 2000);
        })
        .catch(error => {
          appendLine('Error submitting data.');
          console.error('Error:', error);
        });
    }
  
    addInputListener();
    updatePrompt();
  </script>
</body>
</html>
